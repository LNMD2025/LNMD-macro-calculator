<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LNMD Macro Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-center mb-6">LNMD Macro Calculator</h1>
        <div class="space-y-4">
            <div>
                <label for="wakeTime" class="block text-sm font-medium text-gray-700">Wake Time (24h format)</label>
                <select id="wakeTime" class="mt-1 block w-full p-2 border rounded-md" required>
                    <option value="">Select hour</option>
                </select>
            </div>
            <div>
                <label for="sleepTime" class="block text-sm font-medium text-gray-700">Sleep Time (24h format)</label>
                <select id="sleepTime" class="mt-1 block w-full p-2 border rounded-md" required>
                    <option value="">Select hour</option>
                </select>
            </div>
            <div>
                <label for="weight" class="block text-sm font-medium text-gray-700">Weight (kg)</label>
                <input type="number" id="weight" class="mt-1 block w-full p-2 border rounded-md" placeholder="Enter your weight" required>
            </div>
            <div>
                <label for="bodyFat" class="block text-sm font-medium text-gray-700">Body Fat Percentage (%)</label>
                <input type="number" id="bodyFat" min="0" max="100" class="mt-1 block w-full p-2 border rounded-md" placeholder="Enter body fat %" required>
            </div>
            <div>
                <label for="steps" class="block text-sm font-medium text-gray-700">Daily Steps (1000-10000)</label>
                <input type="number" id="steps" min="1000" max="10000" class="mt-1 block w-full p-2 border rounded-md" placeholder="Enter daily steps" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Exercise Hours per Week (1-40)</label>
                <div id="trainingTypes" class="space-y-2">
                    <div class="flex items-center space-x-2">
                        <select class="trainingType w-2/3 p-2 border rounded-md">
                            <option value="0">Select Training Type</option>
                            <option value="3">Yoga/Pilates (MET: 3)</option>
                            <option value="4.5">Weightlifting (MET: 4.5)</option>
                            <option value="7">Cycling (MET: 7)</option>
                            <option value="8">Swimming (MET: 8)</option>
                            <option value="9">Running (MET: 9)</option>
                            <option value="10">HIIT/Crossfit (MET: 10)</option>
                        </select>
                        <input type="number" class="trainingHours w-1/3 p-2 border rounded-md" min="0" max="40" placeholder="Hours" required>
                    </div>
                </div>
                <button onclick="addTrainingType()" class="mt-2 text-blue-600 hover:underline">+ Add Another Training Type</button>
            </div>
            <div>
                <label for="sessionsPerDay" class="block text-sm font-medium text-gray-700">Training Sessions per Day (1-3)</label>
                <select id="sessionsPerDay" class="mt-1 block w-full p-2 border rounded-md" onchange="updateSessionTimes()">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
            </div>
            <div id="sessionTimes" class="space-y-2">
                <!-- Session time selectors -->
            </div>
            <div>
                <label for="macroGoal" class="block text-sm font-medium text-gray-700">Macro Goal</label>
                <select id="macroGoal" class="mt-1 block w-full p-2 border rounded-md">
                    <option value="maintain">Maintain Weight</option>
                    <option value="recomp">Body Recomposition</option>
                    <option value="moderateCut">Moderate Weight Loss</option>
                    <option value="aggressiveCut">Aggressive Weight Loss</option>
                    <option value="aggressiveBulk">Aggressive Weight Gain</option>
                    <option value="performance">Athletic Performance</option>
                </select>
            </div>
            <div>
                <label for="proteinLevel" class="block text-sm font-medium text-gray-700">Protein Level (per kg total weight)</label>
                <select id="proteinLevel" class="mt-1 block w-full p-2 border rounded-md">
                    <option value="0.8">Low (0.8g/kg)</option>
                    <option value="1.5">Moderate (1.5g/kg)</option>
                    <option value="2.2">High (2.2g/kg)</option>
                </select>
            </div>
            <div>
                <label for="fatLevel" class="block text-sm font-medium text-gray-700">Fat Level (per kg lean mass)</label>
                <select id="fatLevel" class="mt-1 block w-full p-2 border rounded-md">
                    <option value="0.8">Low (0.8g/kg)</option>
                    <option value="1.4">Moderate (1.4g/kg)</option>
                    <option value="2.0">High (2.0g/kg)</option>
                </select>
            </div>
            <button onclick="calculateMacros()" class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700">Calculate</button>
        </div>
        <div id="results" class="mt-6 hidden">
            <h2 class="text-lg font-semibold">Your Daily Macros</h2>
            <p id="calories" class="text-gray-700"></p>
            <p id="protein" class="text-gray-700"></p>
            <p id="carbs" class="text-gray-700"></p>
            <p id="fats" class="text-gray-700"></p>
            <h2 class="text-lg font-semibold mt-4">Calculation Breakdown</h2>
            <p id="breakdown" class="text-gray-700"></p>
            <h2 class="text-lg font-semibold mt-4">Macro Partitioning Timeline</h2>
            <div id="partitioning" class="text-gray-700"></div>
            <h2 class="text-lg font-semibold mt-4">Meal Planner (Beta)</h2>
            <div id="mealPlanner" class="text-gray-700"></div>
        </div>
    </div>

    <script>
        // Populate hour dropdowns
        function populateHours(selectId) {
            const select = document.getElementById(selectId);
            for (let i = 0; i < 24; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i.toString().padStart(2, '0')}:00`;
                select.appendChild(option);
            }
        }

        populateHours('wakeTime');
        populateHours('sleepTime');

        function addTrainingType() {
            const container = document.getElementById('trainingTypes');
            const newTrainingDiv = document.createElement('div');
            newTrainingDiv.classList.add('flex', 'items-center', 'space-x-2');
            newTrainingDiv.innerHTML = `
                <select class="trainingType w-2/3 p-2 border rounded-md">
                    <option value="0">Select Training Type</option>
                    <option value="3">Yoga/Pilates (MET: 3)</option>
                    <option value="4.5">Weightlifting (MET: 4.5)</option>
                    <option value="7">Cycling (MET: 7)</option>
                    <option value="8">Swimming (MET: 8)</option>
                    <option value="9">Running (MET: 9)</option>
                    <option value="10">HIIT/Crossfit (MET: 10)</option>
                </select>
                <input type="number" class="trainingHours w-1/3 p-2 border rounded-md" min="0" max="40" placeholder="Hours" required>
            `;
            container.appendChild(newTrainingDiv);
        }

        function updateSessionTimes() {
            const sessions = parseInt(document.getElementById('sessionsPerDay').value);
            const container = document.getElementById('sessionTimes');
            container.innerHTML = '';
            for (let i = 1; i <= sessions; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label for="sessionTime${i}" class="block text-sm font-medium text-gray-700">Session ${i} Time (24h format)</label>
                    <select id="sessionTime${i}" class="mt-1 block w-full p-2 border rounded-md" required>
                        <option value="">Select hour</option>
                    </select>
                `;
                container.appendChild(div);
                populateHours(`sessionTime${i}`);
            }
        }

        updateSessionTimes();

        function formatTime(hour) {
            let ampm = hour >= 12 ? 'pm' : 'am';
            hour = hour % 12;
            hour = hour ? hour : 12;
            return hour + ampm;
        }

        function calculateMacros() {
            const wakeTime = parseInt(document.getElementById('wakeTime').value);
            const sleepTime = parseInt(document.getElementById('sleepTime').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const bodyFat = parseFloat(document.getElementById('bodyFat').value);
            const steps = parseFloat(document.getElementById('steps').value);
            const macroGoal = document.getElementById('macroGoal').value;
            const proteinPerKg = parseFloat(document.getElementById('proteinLevel').value);
            const fatPerKg = parseFloat(document.getElementById('fatLevel').value);
            const sessionsPerDay = parseInt(document.getElementById('sessionsPerDay').value);

            const sessionTimes = [];
            for (let i = 1; i <= sessionsPerDay; i++) {
                sessionTimes.push(parseInt(document.getElementById(`sessionTime${i}`).value));
            }

            if (isNaN(wakeTime) || isNaN(sleepTime) || !weight || !bodyFat || !steps || weight <= 0 || bodyFat < 0 || bodyFat > 100 || steps < 1000 || steps > 10000) {
                alert('Please enter valid inputs.');
                return;
            }

            const leanBodyMass = weight * (1 - bodyFat / 100);

            const trainingTypes = document.querySelectorAll('.trainingType');
            const trainingHours = document.querySelectorAll('.trainingHours');
            let totalHours = 0;
            const trainingData = [];
            for (let i = 0; i < trainingTypes.length; i++) {
                const met = parseFloat(trainingTypes[i].value);
                const hours = parseFloat(trainingHours[i].value) || 0;
                if (met > 0 && hours > 0) {
                    trainingData.push({ met, hours });
                    totalHours += hours;
                }
            }

            if (totalHours < 1 || totalHours > 40) {
                alert('Total exercise hours must be between 1 and 40.');
                return;
            }

            const bmr = 370 + 21.6 * leanBodyMass;

            const baseTdee = bmr * 1.2;

            const metSteps = 3.5;
            const stepsPerHour = 6000;
            const stepsCal = metSteps * weight * (steps / stepsPerHour);

            let exerciseCalPerDay = 0;
            for (const { met, hours } of trainingData) {
                exerciseCalPerDay += met * weight * (hours / 7);
            }

            const tdee = baseTdee + stepsCal + exerciseCalPerDay;

            let calories;
            let deficitSurplus;
            if (macroGoal === 'aggressiveCut') {
                calories = tdee * 0.7;
                deficitSurplus = '30% deficit';
            } else if (macroGoal === 'moderateCut') {
                calories = tdee * 0.85;
                deficitSurplus = '15% deficit';
            } else if (macroGoal === 'aggressiveBulk') {
                calories = tdee * 1.2;
                deficitSurplus = '20% surplus';
            } else if (macroGoal === 'recomp') {
                calories = tdee * 0.95;
                deficitSurplus = '5% deficit';
            } else if (macroGoal === 'performance') {
                calories = tdee * 1.1;
                deficitSurplus = '10% surplus';
            } else {
                calories = tdee;
                deficitSurplus = 'maintenance';
            }

            const proteinGrams = Math.round(weight * proteinPerKg);
            const proteinCalories = proteinGrams * 4;
            const fatGrams = Math.round(leanBodyMass * fatPerKg);
            const fatCalories = fatGrams * 9;
            const carbCalories = calories - (proteinCalories + fatCalories);
            const carbGrams = Math.round(carbCalories / 4);

            document.getElementById('calories').textContent = `Calories: ${Math.round(calories)} kcal`;
            document.getElementById('protein').textContent = `Protein: ${proteinGrams}g`;
            document.getElementById('carbs').textContent = `Carbohydrates: ${carbGrams}g`;
            document.getElementById('fats').textContent = `Fats: ${fatGrams}g`;

            const breakdown = `
Lean Body Mass: ${Math.round(leanBodyMass)} kg<br>
BMR (Katch-McArdle): ${Math.round(bmr)} kcal<br>
Base TDEE (sedentary): ${Math.round(baseTdee)} kcal<br>
Calories from steps: ${Math.round(stepsCal)} kcal<br>
Calories from exercise: ${Math.round(exerciseCalPerDay)} kcal<br>
Total TDEE: ${Math.round(tdee)} kcal<br>
Calorie adjustment (${deficitSurplus}): ${Math.round(calories)} kcal<br>
Protein (${proteinPerKg}g/kg total weight): ${proteinGrams}g (${proteinCalories} kcal)<br>
Fats (${fatPerKg}g/kg lean mass): ${fatGrams}g (${fatCalories} kcal)<br>
Carbs (remaining): ${carbGrams}g (${Math.round(carbCalories)} kcal)
            `;
            document.getElementById('breakdown').innerHTML = breakdown;

            const partitioningDiv = document.getElementById('partitioning');
            partitioningDiv.innerHTML = '';

            let totalWorkoutCarb = 0.5;
            let totalWorkoutProtein = 0.5;
            let totalWorkoutFat = 0.3;

            if (macroGoal === 'performance' || macroGoal === 'aggressiveBulk') {
                totalWorkoutCarb = 0.7;
                totalWorkoutProtein = 0.4;
                totalWorkoutFat = 0.2;
            } else if (macroGoal === 'aggressiveCut' || macroGoal === 'recomp' || macroGoal === 'moderateCut') {
                totalWorkoutCarb = 0.4;
                totalWorkoutProtein = 0.6;
                totalWorkoutFat = 0.4;
            }

            const perSessionCarb = totalWorkoutCarb / sessionsPerDay;
            const perSessionProtein = totalWorkoutProtein / sessionsPerDay;
            const perSessionFat = totalWorkoutFat / sessionsPerDay;

            const carbPrePct = 0.3, carbIntraPct = 0.3, carbPostPct = 0.4;
            const proteinPrePct = 0.3, proteinIntraPct = 0.2, proteinPostPct = 0.5;
            const fatPrePct = 0.4, fatIntraPct = 0.2, fatPostPct = 0.4;

            const numOtherMeals = 3;
            const remainingCarb = 1 - totalWorkoutCarb;
            const remainingProtein = 1 - totalWorkoutProtein;
            const remainingFat = 1 - totalWorkoutFat;
            const carbOther = remainingCarb / numOtherMeals;
            const proteinOther = remainingProtein / numOtherMeals;
            const fatOther = remainingFat / numOtherMeals;

            const events = [];
            sessionTimes.forEach((startHour, index) => {
                if (startHour < wakeTime) startHour += 24;
                const sessionNum = index + 1;

                events.push({
                    hour: startHour - 1,
                    label: `${formatTime(startHour - 1)} - Pre-workout (Session ${sessionNum})`,
                    type: 'pre'
                });

                events.push({
                    hour: startHour,
                    label: `${formatTime(startHour)} - Intra-workout (Session ${sessionNum})`,
                    type: 'intra'
                });

                events.push({
                    hour: startHour + 1,
                    label: `${formatTime(startHour + 1)} - Post-workout (Session ${sessionNum})`,
                    type: 'post'
                });
            });

            events.sort((a, b) => a.hour - b.hour);

            events.forEach(event => {
                let pFrac, cFrac, fFrac;
                if (event.type === 'pre') {
                    pFrac = proteinPrePct * perSessionProtein;
                    cFrac = carbPrePct * perSessionCarb;
                    fFrac = fatPrePct * perSessionFat;
                } else if (event.type === 'intra') {
                    pFrac = proteinIntraPct * perSessionProtein;
                    cFrac = carbIntraPct * perSessionCarb;
                    fFrac = fatIntraPct * perSessionFat;
                } else {
                    pFrac = proteinPostPct * perSessionProtein;
                    cFrac = carbPostPct * perSessionCarb;
                    fFrac = fatPostPct * perSessionFat;
                }
                event.protein = Math.round(proteinGrams * pFrac);
                event.carbs = Math.round(carbGrams * cFrac);
                event.fats = Math.round(fatGrams * fFrac);
            });

            let html = '<ul class="list-none space-y-2">';
            events.forEach(event => {
                html += `<li class="p-2 bg-gray-50 rounded-md"><strong>${event.label}:</strong> Protein ${event.protein}g, Carbs ${event.carbs}g, Fats ${event.fats}g</li>`;
            });
            html += '</ul>';

            html += '<h3 class="text-md font-medium mt-4">Other Meals</h3>';
            html += `<p class="mb-2">Distribute the remaining macros evenly across 3 main meals between ${formatTime(wakeTime)} and ${formatTime(sleepTime)} at times not conflicting with workouts:</p>`;
            const otherProtein = Math.round(proteinGrams * proteinOther);
            const otherCarbs = Math.round(carbGrams * carbOther);
            const otherFats = Math.round(fatGrams * fatOther);
            html += `<p class="p-2 bg-gray-50 rounded-md">Each other meal: Protein ${otherProtein}g, Carbs ${otherCarbs}g, Fats ${otherFats}g</p>`;

            partitioningDiv.innerHTML = html;

            const mealPlannerDiv = document.getElementById('mealPlanner');
            mealPlannerDiv.innerHTML = '<p>Suggested Meal: Breakfast - Oatmeal (Carbs 30g, Protein 10g, Fats 5g)<br>Lunch - Chicken Salad (Protein 40g, Carbs 20g, Fats 15g)<br>Dinner - Salmon with Veggies (Protein 30g, Carbs 25g, Fats 20g)</p><p>Customize with allergies/filters in future updates.</p>';

            document.getElementById('results').classList.remove('hidden');

            if (carbGrams < 0) {
                alert('Warning: Carbohydrate grams are negative. Consider lowering protein or fat levels, or increasing exercise hours/steps for more calories.');
            }
        }
    </script>
</body>
</html>